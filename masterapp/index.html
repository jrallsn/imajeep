<html>
<head>
</head>
<body>
	MASTER APP INDEX

	<script type="text/javascript">
		
		var exampleSocket = new WebSocket("wss://api.seawall.horse/");
		var activeRoomId;

		exampleSocket.onopen = function(event) {
			console.log('opened socket');
		};

		function createRoom() {
			exampleSocket.send(JSON.stringify({
				action: 'init'
			}));
		}

		function sendMessage() {
			var messageBox = document.getElementById('messagebox');
			var textToSend = messageBox.value;
			/*var roomIdBox = document.getElementById('roomidbox');
			var roomId = roomIdBox.value;*/

			exampleSocket.send(JSON.stringify({
				action: 'testMsg',
				message: textToSend,
				roomId: activeRoomId
			}));
		}

		var currentState = '';
		var players = [];

		exampleSocket.onmessage = function(event) {
			console.log(event.data);
			try {
				var data = JSON.parse(event.data);
				if(data.info === 'roomCreated'){
					activeRoomId = data.roomId;
					document.getElementById('roomiddiv').innerHTML = activeRoomId;
				}
			} catch (e) {

			}
			document.getElementById('response-div').innerHTML = event.data;

			var message = JSON.parse(event.data);

			switch (message.state) {
				case 'WAITING_FOR_PLAYERS':
					activeRoomId = message.roomId;

					if (message.info === 'playerJoined') {
						players.push({
							userName: message.info.userName
						});
					}
					
					document.getElementById('players').innerHTML = players.toString();

					break;
				default:
					break;
			}
		};


	</script>
	<br>
	<button onclick="createRoom()">Create a room</button>
	<br>
	<input type="text" id="messagebox">
	ROOM: <div id="roomiddiv"></div>
	<button onclick="sendMessage()">Send message</button>
	<br> 
	<div id="response-div"></div>

	<div id='players'>

	</div>




</body>
</html>
